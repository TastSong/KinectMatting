# KinectMatting
## 环境配置
* opencv2.4.9
* vs2013
* KinectSDK2.0
## 注释
SDK中提供了一个叫`ICoordinateMapper`的类，功能就是坐标系之间的互相转换，用来解决数据源的分辨率不同导致点对应不起来的问题。
我们需要的是将彩色图像中的点与深度图像中的点一一对应起来，因此使用其中的`MapColorFrameToDepthSpace()`这个函数。

首选，需要准备好三种数据源：`Color`、`BodyIndex`、`Depth`，其中前两个是完成功能本来就需要的，第三个是转换坐标系时需要，
无法直接把`Color`的坐标系映射到`BodyIndex`中，只能映射到`Depth`中。

然后是读取背景图，读取之后也要转换成`Color`图的尺寸，这样把`Color`中的点贴过去时坐标就不用再转换，直接替换就行。接下来也要读取三种`Frame`，
为了易读性，不如把准备工作在前面都做完，在这一步直接用`Reader`就行。

然后，利用MapColorFrameToDepthSpace()，将彩色帧映射到深度坐标系，它需要4个参数，第1个是深度帧的大小，第2个是深度数据，第3个是彩色帧的大小，
第4个是一个`DepthSpacePoint`的数组，它用来储存彩色空间中的每个点对应到深度空间的坐标。
要注意，这个函数只是完成坐标系的转换，也就是说它对于彩色坐标系中的每个点，都给出了一个此点对应到深度坐标系中的坐标，并不涉及到具体的`ColorFrame`。

最后，遍历彩色图像，对于每一点，都取出它对应的深度坐标系的坐标，然后把这个坐标放入BodyIndex的数据中，判断此点是否属于人体，如果属于，
就把这点从彩色图中取出，跟背景图中同一坐标的点替换。

要注意的是，`DepthSpacePoint`中的X和Y的值都是float的，用它们来计算在`BodyIndex`里的坐标时，需要强转成int，不然画面就会不干净，
一些不属于人体的地方也被标记成了人体被替换掉。
